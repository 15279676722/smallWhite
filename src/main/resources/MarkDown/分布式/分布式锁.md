### Redis 实现分布式锁(AP)

#### 1.setnx 

> 通过原子命令 set key value NX PX millseconds

**缺点**

- 需要通过循环去获取锁，影响性能 不具备阻塞能力(未获取到锁的情况下进入阻塞状态，需要手动自旋)
- 非公平锁，每个线程都是在循环获得锁，不可重入锁
- redis集群情况下存在 主从延迟 ，可能会导致锁失效
- key失效时间不好把控 如果有redis节点挂了 可能会导致锁没有及时释放

#### 2.Redission

> 加入看门狗机制，每过key失效的1/3时间的时候，看门狗会进行续约
>
> Redission 加锁是通过 hash类型的字段来进行的，可重入锁是对其value 进行累加

**缺点**



- redis集群情况下存在 主从延迟 ，可能会导致锁失效

#### 3.RedLock 

> n/2 +1个节点成功则认为成功



### Zookeeper(CP)

> 利用临时有序节点 每个线程都会创建一个临时有序的节点，当前序号最小的获得锁，其他节点对其上一个节点进行监听操作，锁释放后会对其进行唤醒

**优点**

- zookeeper临时有序节点如果zookeeper节点挂了 会自动删除节点 不会产生死锁
- 使用监听器的方式进行等待锁

### 数据库悲观锁(不建议使用)

> select * from table for update 并发量大的情况下对数据库压力很大